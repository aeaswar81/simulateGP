<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Background notes: Simulating GWAS summary data • simulateGP</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Background notes: Simulating GWAS summary data">
<meta property="og:description" content="simulateGP">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simulateGP</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">Guide</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/explodecomputer/simulateGP">Source</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="gwas_summary_data_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Background notes: Simulating GWAS summary data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/explodecomputer/simulateGP/blob/master/vignettes/gwas_summary_data.Rmd"><code>vignettes/gwas_summary_data.Rmd</code></a></small>
      <div class="hidden name"><code>gwas_summary_data.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://explodecomputer.github.io/simulateGP/">simulateGP</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="co">#&gt; ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.0 ──</span>
<span class="co">#&gt; ✔ ggplot2 3.3.2     ✔ purrr   0.3.4</span>
<span class="co">#&gt; ✔ tibble  3.0.4     ✔ dplyr   1.0.2</span>
<span class="co">#&gt; ✔ tidyr   1.1.2     ✔ stringr 1.4.0</span>
<span class="co">#&gt; ✔ readr   1.4.0     ✔ forcats 0.5.0</span>
<span class="co">#&gt; ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──</span>
<span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span>
<span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span></pre></div>
<p>GWAS summary data can be generated in two ways</p>
<ol style="list-style-type: decimal">
<li>Given a set of parameters, generate the genotypes for a set of individuals and the phenotypes that arise from those genotypes. Then obtain linear regression estimates from these simulated individual level data</li>
<li>Given a set of parameters, simulate the summary level data directly</li>
</ol>
<p>here we look at (1).</p>
<p>Given the following inputs:</p>
<ol style="list-style-type: decimal">
<li>True causal effects of a set of SNPs</li>
<li>Minor allele frequency of those SNPs</li>
<li>Heritability explained by those SNPs</li>
<li>Sample size in which they are estimated</li>
</ol>
<p>We would like to obtain:</p>
<ol style="list-style-type: decimal">
<li>Standard error of SNP effect on trait</li>
<li>Sampled estimate of SNP effect on trait</li>
<li>P-value of SNP effect estimate for trait</li>
</ol>
<p>Strategy is to begin by obtaining the expected standard error for the true causal effect for each SNP, and then sampling an estimated SNP effect based on the expected standard error.</p>
<div id="expected-standard-error" class="section level2">
<h2 class="hasAnchor">
<a href="#expected-standard-error" class="anchor"></a>Expected standard error</h2>
<p>For a linear model</p>
<p><span class="math display">\[
y_i = \beta_0 + \beta_1 x_i + \epsilon_i
\]</span></p>
<p>The coefficient estimates are</p>
<p><span class="math display">\[
\hat{\beta}_1 = cov(x,y) / var(x)
\]</span></p>
<p>and</p>
<p><span class="math display">\[
\hat{\beta}_0 = \bar{y} - \hat{\beta}_1 \bar{x}
\]</span></p>
<p>The standard error of a regression coefficient is:</p>
<p><span class="math display">\[
s_{\hat{\beta}_1} = \sqrt{\frac{\sum{\epsilon_i^2}}{(n-2) \sum{(x_i - \bar{x})^2}}}
\]</span></p>
<p>This can be broken down. The denominator is the sum of squares of X:</p>
<p><span class="math display">\[
\begin{aligned}
(x_i - \bar{x})^2 &amp;= (n-1) Var(x) \\
&amp;\approx (n-1) 2p(1-p)
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(p\)</span> is the allele frequency of the SNP and <span class="math inline">\(n\)</span> is the sample size. The numerator is the mean squared error, which relates to the variance unexplained in Y:</p>
<p><span class="math display">\[
\begin{aligned}
\sum \epsilon_i^2 &amp;= \sum(y_i - \hat{y}_i)^2 / (n-1) \\
&amp;= Var(y) - r^2 Var(y) \\
&amp;\approx Var(y) - \hat{\beta}_1^2 Var(x) \\
&amp;\approx Var(y) - 2 p(1-p) \hat{\beta}_1^2
\end{aligned}
\]</span></p>
<p>Quick check:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span>
<span class="co">#&gt; [1] 0.1106278</span>
<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.1106278</span></pre></div>
</div>
<div id="sampling-the-effect-estimate" class="section level2">
<h2 class="hasAnchor">
<a href="#sampling-the-effect-estimate" class="anchor"></a>Sampling the effect estimate</h2>
<p>Given a standard error <span class="math inline">\(s_{\hat{\beta}_1}\)</span>, we can obtain an estimated value for <span class="math inline">\(\beta_1\)</span> using</p>
<p><span class="math display">\[
\hat{\beta}_1 \sim N(\beta_1, s_{\hat{\beta}_1})
\]</span></p>
<p>Question: Do I need to update the expected standard error based on the sampled value of <span class="math inline">\(\hat{\beta}_1\)</span>?</p>
</div>
<div id="sampling-a-set-of-effect-estimates" class="section level2">
<h2 class="hasAnchor">
<a href="#sampling-a-set-of-effect-estimates" class="anchor"></a>Sampling a set of effect estimates</h2>
<p>Suppose we need a set of SNPs to explain some proportion of the variance in a trait.</p>
<p>When specifying the SNP effects there is a simple model that can relate to a SNP to its contribution to heritability</p>
<p><span class="math display">\[
h^2_j = \frac{2p_j(1-p_j)\beta^2_j}{Var(y)}
\]</span></p>
<p>Also</p>
<p><span class="math display">\[
\begin{aligned}
h_j^2 &amp;= \frac{Cov(x_j, y)^2}{Var(x_j)Var(y)} \\
&amp;= \frac{\beta_j^2}{Var(y)}
\end{aligned}
\]</span></p>
<p>and</p>
<p><span class="math display">\[
h^2 = \sum^M_j h_j^2
\]</span></p>
<p>If each SNP has MAF of <span class="math inline">\(p_j\)</span> and effect of <span class="math inline">\(\beta_j\)</span>, then</p>
<p><span class="math display">\[
V_G = \sum^M_j 2p_j(1-p_j)\beta^2_j
\]</span></p>
<p><span class="math display">\[
V_E = \frac{V_G(1 - h^2)}{h^2}
\]</span> and</p>
<p><span class="math display">\[
Var(y) = V_G + V_E
\]</span></p>
<p>Once SNP effects have been sampled then they can be scaled to represent a phenotype with variance of 1:</p>
<p><span class="math display">\[
\beta_j^* = \frac{\beta_j}{\sqrt{Var(y)}}
\]</span></p>
<p>Relating SNP effects to allele frequencies can be done by specifying a selection model. Generalise the relationship between the SNP effects, allele frequencies and selection coefficient of the trait:</p>
<p><span class="math display">\[
\beta_j \sim N(0, [2p_j (1-p_j)]^S \sigma^2_\beta)
\]</span></p>
<p>Where S is the parameter describing the selection acting on the trait. Here <span class="math inline">\(\sigma^2_\beta = V_G / M\)</span> if all SNPs were scaled to have variance of 1 and mean of 0.</p>
<p><span class="math display">\[
\begin{aligned}
\sigma^2_\beta &amp;= \sum^M_j (\beta_j-\bar{\beta})^2 \\
&amp;= \sum^M_j \beta_j^2
\end{aligned}
\]</span></p>
<p>when the distribution of SNP effects is centred. This can be adapted to the BayesS model, in which some proportion of SNPs have no effect:</p>
<p><span class="math display">\[
\beta_j \sim N(0, [2p_j (1-p_j)]^S \sigma^2_\beta)\pi + \vartheta (1 - \pi)
\]</span></p>
<p>I think ultimately the presence of <span class="math inline">\(\sigma^2_\beta\)</span> in this model does not actually mean anything, it scales the SNP effects with respect to the variance of the phenotype. Use the following function to generate SNP effects for a set of SNPs according to specified MAF, heritability and selection model:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="va">generate_gwas_params</span>
<span class="co">#&gt; function (map, h2, S = 0, Pi = 1) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     stopifnot(all(c("snp", "af") %in% names(map)))</span>
<span class="co">#&gt;     stopifnot(all(map$af &gt; 0 &amp; map$af &lt; 1))</span>
<span class="co">#&gt;     stopifnot(!any(duplicated(map$snp)))</span>
<span class="co">#&gt;     nsnp &lt;- nrow(map)</span>
<span class="co">#&gt;     if (h2 == 0) {</span>
<span class="co">#&gt;         map$beta &lt;- 0</span>
<span class="co">#&gt;         return(map)</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     index &lt;- sample(1:nsnp, ceiling(nsnp * Pi), replace = FALSE)</span>
<span class="co">#&gt;     map$beta &lt;- 0</span>
<span class="co">#&gt;     map$beta[index] &lt;- stats::rnorm(length(index), mean = 0, </span>
<span class="co">#&gt;         sd = sqrt((map$af[index] * 2 * (1 - map$af[index]))^S))</span>
<span class="co">#&gt;     vg &lt;- sum(map$af * 2 * (1 - map$af) * map$beta^2)</span>
<span class="co">#&gt;     ve &lt;- (vg - h2 * vg)/h2</span>
<span class="co">#&gt;     vy &lt;- vg + ve</span>
<span class="co">#&gt;     map$beta &lt;- map$beta/sqrt(vy)</span>
<span class="co">#&gt;     return(map)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x7f83fc79c078&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:simulateGP&gt;</span></pre></div>
<p>Create a map</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="va">map</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>af<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">0.01</span>, <span class="fl">0.5</span><span class="op">)</span>, snp<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span><span class="op">)</span></pre></div>
<p>Negative selection:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_gwas_params.html">generate_gwas_params</a></span><span class="op">(</span><span class="va">map</span>, h2<span class="op">=</span><span class="fl">0.4</span>, S<span class="op">=</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></pre></div>
<p><img src="gwas_summary_data_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Positive selection:</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_gwas_params.html">generate_gwas_params</a></span><span class="op">(</span><span class="va">map</span>, h2<span class="op">=</span><span class="fl">0.4</span>, S<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></pre></div>
<p><img src="gwas_summary_data_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Neutral model:</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_gwas_params.html">generate_gwas_params</a></span><span class="op">(</span><span class="va">map</span>, h2<span class="op">=</span><span class="fl">0.4</span>, S<span class="op">=</span><span class="fl">0</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></pre></div>
<p><img src="gwas_summary_data_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Note that the genetic variance is the heritability</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">beta</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">g</span><span class="op">$</span><span class="va">af</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">g</span><span class="op">$</span><span class="va">af</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.4</span></pre></div>
<p>Bringing it all together, we can simulate a set of GWAS summary stats by first specifying the true effects we want, and then obtaining sampled effects, standard errors and p-values.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="co"># Simulate 1 million SNPs, </span>
<span class="co"># with 10 large effects, </span>
<span class="co"># a polygenic background of 10000 SNPs, </span>
<span class="co"># and all others with no effects</span>

<span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span>
    <span class="fu">tibble</span><span class="op">(</span>af <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span><span class="op">)</span>, group<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,
    <span class="fu">tibble</span><span class="op">(</span>af <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10000</span>, <span class="fl">0.01</span>, <span class="fl">0.5</span><span class="op">)</span>, group<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,
    <span class="fu">tibble</span><span class="op">(</span>af <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1000000</span><span class="op">-</span><span class="fl">10</span><span class="op">-</span><span class="fl">10000</span>, <span class="fl">0.01</span>, <span class="fl">0.5</span><span class="op">)</span>, group<span class="op">=</span><span class="fl">3</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>snp<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/generate_gwas_params.html">generate_gwas_params</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/subset.data.table.html">subset</a></span><span class="op">(</span><span class="va">map</span>, <span class="va">group</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span>, h2<span class="op">=</span><span class="fl">0.1</span>, S<span class="op">=</span><span class="fl">0</span><span class="op">)</span>,
    <span class="fu"><a href="../reference/generate_gwas_params.html">generate_gwas_params</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/subset.data.table.html">subset</a></span><span class="op">(</span><span class="va">map</span>, <span class="va">group</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span>, h2<span class="op">=</span><span class="fl">0.3</span>, S<span class="op">=</span><span class="fl">0</span><span class="op">)</span>,
    <span class="fu"><a href="../reference/generate_gwas_params.html">generate_gwas_params</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/subset.data.table.html">subset</a></span><span class="op">(</span><span class="va">map</span>, <span class="va">group</span><span class="op">==</span><span class="fl">3</span><span class="op">)</span>, h2<span class="op">=</span><span class="fl">0</span>, S<span class="op">=</span><span class="fl">0</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># Generate GWAS summary stats</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_gwas_ss.html">generate_gwas_ss</a></span><span class="op">(</span><span class="va">param</span>, <span class="fl">450000</span><span class="op">)</span></pre></div>
<p>Compare to individual level data results to summary data simulations</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>
<span class="va">h2</span> <span class="op">&lt;-</span> <span class="fl">0.1</span>
<span class="va">nid</span> <span class="op">&lt;-</span> <span class="fl">10000</span>
<span class="va">param</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>af<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">0.01</span>, <span class="fl">0.5</span><span class="op">)</span>, snp<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/generate_gwas_params.html">generate_gwas_params</a></span><span class="op">(</span>h2<span class="op">=</span><span class="va">h2</span>, S<span class="op">=</span><span class="fl">0</span><span class="op">)</span>
<span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_gwas_ss.html">generate_gwas_ss</a></span><span class="op">(</span><span class="va">param</span>, <span class="va">nid</span><span class="op">)</span>

<span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">param</span><span class="op">$</span><span class="va">af</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">nid</span>, <span class="fl">2</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">bind_cols</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; New names:</span>
<span class="co">#&gt; * NA -&gt; ...1</span>
<span class="co">#&gt; * NA -&gt; ...2</span>
<span class="co">#&gt; * NA -&gt; ...3</span>
<span class="co">#&gt; * NA -&gt; ...4</span>
<span class="co">#&gt; * NA -&gt; ...5</span>
<span class="co">#&gt; * ...</span>

<span class="va">score</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">%*%</span> <span class="va">param</span><span class="op">$</span><span class="va">beta</span>
<span class="va">err</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">nid</span>, mean<span class="op">=</span><span class="fl">0</span>, sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">h2</span><span class="op">)</span> <span class="op">/</span> <span class="va">h2</span><span class="op">)</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="va">score</span> <span class="op">+</span> <span class="va">err</span>
<span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gwas.html">gwas</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">g</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">res2</span><span class="op">$</span><span class="va">bhat</span> <span class="op">~</span> <span class="va">res1</span><span class="op">$</span><span class="va">bhat</span><span class="op">)</span></pre></div>
<p><img src="gwas_summary_data_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">res2</span><span class="op">$</span><span class="va">se</span>, <span class="va">res1</span><span class="op">$</span><span class="va">se</span><span class="op">)</span></pre></div>
<p><img src="gwas_summary_data_files/figure-html/unnamed-chunk-10-2.png" width="700"></p>
<p><strong>TODO: simulate effect estimates for SNPs given LD matrix</strong></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Gibran Hemani, John Ferguson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
